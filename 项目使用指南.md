# AIç—…å†è´¨æ§ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åº”ç”¨

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# Windows
start.bat

# æˆ–è€…ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒè„šæœ¬
start-prod.bat
```

#### æ–¹æ³•äºŒï¼šç›´æ¥å‘½ä»¤è¡Œå¯åŠ¨
```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
java -jar target/ai-medical-score-1.0.0-SNAPSHOT.jar

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
java -jar target/ai-medical-score-1.0.0-SNAPSHOT.jar --spring.profiles.active=prod

# æŒ‡å®šç«¯å£å¯åŠ¨
java -jar target/ai-medical-score-1.0.0-SNAPSHOT.jar --server.port=8080
```

### 2. éªŒè¯åº”ç”¨æ˜¯å¦å¯åŠ¨æˆåŠŸ

æ‰“å¼€æµè§ˆå™¨æˆ–ä½¿ç”¨curlè®¿é—®ï¼š
```
http://localhost:8080/actuator/health
```

çœ‹åˆ°ä»¥ä¸‹å“åº”è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š
```json
{
  "status": "UP",
  "components": {
    "db": {"status": "UP"},
    "diskSpace": {"status": "UP"},
    "ping": {"status": "UP"}
  }
}
```

## ğŸ“ APIæ¥å£ä½¿ç”¨ç¤ºä¾‹

### 3. ç”ŸæˆAIç—…å†è¯„åˆ†

#### æ¥å£åœ°å€
```
POST http://localhost:8080/admin-api/business/ai-score/generate
```

#### è¯·æ±‚ç¤ºä¾‹ï¼ˆä½¿ç”¨curlï¼‰
```bash
curl -X POST http://localhost:8080/admin-api/business/ai-score/generate \
  -H "Content-Type: application/json" \
  -d '{
    "patientId": 3835
  }'
```

#### è¯·æ±‚ç¤ºä¾‹ï¼ˆä½¿ç”¨PowerShellï¼‰
```powershell
$body = @{
    patientId = 3835
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/admin-api/business/ai-score/generate" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

#### é¢„æœŸå“åº”
```json
{
  "msg": "è¯„åˆ†ç”ŸæˆæˆåŠŸ",
  "code": 0,
  "data": {
    "patientId": 3835,
    "id": 1,
    "status": "completed"
  }
}
```

### 4. æŸ¥çœ‹è¯„åˆ†æŠ¥å‘Š

#### æ¥å£åœ°å€
```
GET http://localhost:8080/admin-api/business/ai-score/report/{patientId}
```

#### è¯·æ±‚ç¤ºä¾‹
```bash
# curl
curl -X GET http://localhost:8080/admin-api/business/ai-score/report/3835

# PowerShell
Invoke-RestMethod -Uri "http://localhost:8080/admin-api/business/ai-score/report/3835" -Method GET
```

#### é¢„æœŸå“åº”
```json
{
  "msg": "",
  "code": 0,
  "data": {
    "patientName": "èƒ¡å®‰ç§€",
    "patientId": 3835,
    "id": 1,
    "scoreResult": {
      "totalScore": 86,
      "level": "ä¹™çº§",
      "details": [
        {
          "item": "ä¸»è¯‰",
          "score": 5,
          "fullScore": 10,
          "deduction": "ä¸»è¯‰ä¸å®Œæ•´ï¼Œä»…æåŠç»´æŒè¡€é€5å¹´ä½™ï¼Œç¼ºå°‘å½“å‰ç—‡çŠ¶æè¿°"
        },
        {
          "item": "ç—…å²",
          "score": 20,
          "fullScore": 20,
          "deduction": "æ— æ‰£åˆ†"
        }
      ]
    },
    "expertComment": null,
    "createdTime": "2025-07-04T16:39:31",
    "updatedTime": "2025-07-04T16:39:31"
  }
}
```

### 5. ä¿å­˜ä¸“å®¶ç‚¹è¯„

#### æ¥å£åœ°å€
```
POST http://localhost:8080/admin-api/business/ai-score/expert-comment
```

#### è¯·æ±‚ç¤ºä¾‹
```bash
curl -X POST http://localhost:8080/admin-api/business/ai-score/expert-comment \
  -H "Content-Type: application/json" \
  -d '{
    "patientId": 3835,
    "expertComment": "ç—…å†è®°å½•è§„èŒƒï¼Œè¯Šæ–­å‡†ç¡®ï¼Œå»ºè®®åŠ å¼ºæ²»ç–—æ–¹æ¡ˆçš„ä¸ªæ€§åŒ–"
  }'
```

#### è¯·æ±‚ç¤ºä¾‹ï¼ˆä½¿ç”¨PowerShellï¼‰
```powershell
$body = @{
    patientId = 3835
    expertComment = "ç—…å†è®°å½•è§„èŒƒï¼Œè¯Šæ–­å‡†ç¡®ï¼Œå»ºè®®åŠ å¼ºæ²»ç–—æ–¹æ¡ˆçš„ä¸ªæ€§åŒ–"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/admin-api/business/ai-score/expert-comment" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body
```

## ğŸ”§ æµ‹è¯•ç”¨ä¾‹å’Œæ•°æ®

### 6. å‡†å¤‡æµ‹è¯•æ•°æ®

åˆ›å»ºæµ‹è¯•è„šæœ¬ï¼Œä½¿ç”¨çœŸå®çš„æ‚£è€…IDï¼š
```json
{
  "patientId": 3835
}
```

### 7. æ‰¹é‡æµ‹è¯•è„šæœ¬

åˆ›å»º `batch-test.bat`ï¼š
```batch
@echo off
echo å¼€å§‹æ‰¹é‡æµ‹è¯•AIç—…å†è¯„åˆ†ç³»ç»Ÿ...

echo.
echo 1. æµ‹è¯•å¥åº·æ£€æŸ¥...
curl -s http://localhost:8080/actuator/health

echo.
echo 2. æµ‹è¯•ç—…å†è¯„åˆ†...
curl -X POST http://localhost:8080/admin-api/business/ai-score/generate ^
  -H "Content-Type: application/json" ^
  -d "{\"patientId\":3835}"

echo.
echo 3. æŸ¥çœ‹è¯„åˆ†æŠ¥å‘Š...
curl -X GET http://localhost:8080/admin-api/business/ai-score/report/3835

echo.
echo 4. æ·»åŠ ä¸“å®¶ç‚¹è¯„...
curl -X POST http://localhost:8080/admin-api/business/ai-score/expert-comment ^
  -H "Content-Type: application/json" ^
  -d "{\"patientId\":3835,\"expertComment\":\"æµ‹è¯•ä¸“å®¶ç‚¹è¯„\"}"

echo.
echo æµ‹è¯•å®Œæˆï¼
pause
```

## ğŸŒ æµè§ˆå™¨æµ‹è¯•

### 8. ä½¿ç”¨æµè§ˆå™¨æµ‹è¯•

#### å¥åº·æ£€æŸ¥
ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
```
http://localhost:8080/actuator/health
```

#### åº”ç”¨ä¿¡æ¯
```
http://localhost:8080/actuator/info
```

#### ç›‘æ§æŒ‡æ ‡
```
http://localhost:8080/actuator/metrics
```

### 9. ä½¿ç”¨Postmanæµ‹è¯•

#### å¯¼å…¥Postmané›†åˆ
åˆ›å»º `AI-Medical-Score.postman_collection.json`ï¼š
```json
{
  "info": {
    "name": "AIç—…å†è´¨æ§ç³»ç»Ÿ",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "ç”ŸæˆAIè¯„åˆ†",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"patientId\": 3835\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/admin-api/business/ai-score/generate",
          "host": ["{{baseUrl}}"],
          "path": ["admin-api", "business", "ai-score", "generate"]
        }
      }
    },
    {
      "name": "æŸ¥çœ‹è¯„åˆ†æŠ¥å‘Š",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{baseUrl}}/admin-api/business/ai-score/report/3835",
          "host": ["{{baseUrl}}"],
          "path": ["admin-api", "business", "ai-score", "report", "3835"]
        }
      }
    },
    {
      "name": "ä¿å­˜ä¸“å®¶ç‚¹è¯„",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"patientId\": 3835,\n  \"expertComment\": \"ç—…å†è®°å½•è§„èŒƒï¼Œè¯Šæ–­å‡†ç¡®\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/admin-api/business/ai-score/expert-comment",
          "host": ["{{baseUrl}}"],
          "path": ["admin-api", "business", "ai-score", "expert-comment"]
        }
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080"
    }
  ]
}
```

## ğŸ” æ•…éšœæ’é™¤

### 10. å¸¸è§é—®é¢˜è§£å†³

#### åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :8080

# ä½¿ç”¨ä¸åŒç«¯å£å¯åŠ¨
java -jar target/ai-medical-score-1.0.0-SNAPSHOT.jar --server.port=8081
```

#### æ•°æ®åº“è¿æ¥å¤±è´¥
æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š
- æœåŠ¡å™¨åœ°å€ï¼š172.16.1.15:3306
- æ•°æ®åº“åï¼šbailun
- ç”¨æˆ·å/å¯†ç æ˜¯å¦æ­£ç¡®

#### APIè°ƒç”¨è¿”å›é”™è¯¯
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
tail -f logs/ai-medical-score.log

# æˆ–æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```

#### DeepSeek AIè°ƒç”¨å¤±è´¥
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹æ˜¯å¦è¶…å‡ºAPIè°ƒç”¨é™åˆ¶

### 11. æ—¥å¿—æŸ¥çœ‹

#### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
# Windows
type logs\ai-medical-score.log

# PowerShell
Get-Content logs\ai-medical-score.log -Tail 50
```

#### æŸ¥çœ‹ç‰¹å®šæ—¶é—´çš„æ—¥å¿—
```bash
# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
Get-Content logs\ai-medical-score.log -Tail 100 | Select-String "ERROR|WARN"
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 12. ç›‘æ§åº”ç”¨çŠ¶æ€

#### å†…å­˜ä½¿ç”¨æƒ…å†µ
```
GET http://localhost:8080/actuator/metrics/jvm.memory.used
```

#### HTTPè¯·æ±‚ç»Ÿè®¡
```
GET http://localhost:8080/actuator/metrics/http.server.requests
```

#### æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
```
GET http://localhost:8080/actuator/metrics/hikaricp.connections
```

## ğŸ¯ å®é™…ä½¿ç”¨åœºæ™¯

### 13. HMSç³»ç»Ÿé›†æˆæµ‹è¯•

æ¨¡æ‹ŸHMSç³»ç»Ÿè°ƒç”¨ï¼š
```bash
# æ¨¡æ‹Ÿè·å–æ‚£è€…ä¿¡æ¯
curl -X GET "http://172.16.1.13:10086/admin-api/business/outpatient-blood/get?patientId=3835" \
  -H "Authorization: Bearer 97285ff9-240a-4546-9f14-a9b858397716"

# æ¨¡æ‹Ÿè·å–è¯Šç–—ä¿¡æ¯  
curl -X GET "http://172.16.1.13:10086/admin-api/business/first-course-record/get" \
  -H "Authorization: Bearer 97285ff9-240a-4546-9f14-a9b858397716"
```

### 14. è¯„åˆ†ç»“æœåˆ†æ

æŸ¥çœ‹ä¸åŒç­‰çº§çš„è¯„åˆ†ç»“æœï¼š
- **ç”²çº§ (90-100åˆ†)**: ç—…å†è´¨é‡ä¼˜ç§€
- **ä¹™çº§ (75-89åˆ†)**: ç—…å†è´¨é‡è‰¯å¥½  
- **ä¸™çº§ (60-74åˆ†)**: ç—…å†è´¨é‡ä¸€èˆ¬
- **ä¸åˆæ ¼ (<60åˆ†)**: éœ€è¦æ”¹è¿›

### 15. å®Œæ•´çš„æµ‹è¯•æµç¨‹

#### PowerShellå®Œæ•´æµ‹è¯•è„šæœ¬
```powershell
# æµ‹è¯•å®Œæ•´çš„AIè¯„åˆ†æµç¨‹
Write-Host "=== AIç—…å†è´¨æ§ç³»ç»Ÿæµ‹è¯• ===" -ForegroundColor Green

# 1. æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
Write-Host "1. æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€..." -ForegroundColor Yellow
try {
    $health = Invoke-RestMethod -Uri "http://localhost:8080/actuator/health"
    if ($health.status -eq "UP") {
        Write-Host "âœ… åº”ç”¨è¿è¡Œæ­£å¸¸" -ForegroundColor Green
    }
} catch {
    Write-Host "âŒ åº”ç”¨æœªæ­£å¸¸è¿è¡Œ" -ForegroundColor Red
    exit 1
}

# 2. ç”ŸæˆAIè¯„åˆ†
Write-Host "2. ç”ŸæˆAIè¯„åˆ†..." -ForegroundColor Yellow
$body = @{ patientId = 3835 } | ConvertTo-Json
try {
    $result = Invoke-RestMethod -Uri "http://localhost:8080/admin-api/business/ai-score/generate" -Method POST -ContentType "application/json" -Body $body
    if ($result.code -eq 0) {
        Write-Host "âœ… AIè¯„åˆ†ç”ŸæˆæˆåŠŸ" -ForegroundColor Green
    }
} catch {
    Write-Host "âŒ AIè¯„åˆ†ç”Ÿæˆå¤±è´¥: $($_.Exception.Message)" -ForegroundColor Red
}

# 3. è·å–è¯„åˆ†æŠ¥å‘Š
Write-Host "3. è·å–è¯„åˆ†æŠ¥å‘Š..." -ForegroundColor Yellow
try {
    $report = Invoke-RestMethod -Uri "http://localhost:8080/admin-api/business/ai-score/report/3835" -Method GET
    if ($report.code -eq 0) {
        Write-Host "âœ… è¯„åˆ†æŠ¥å‘Šè·å–æˆåŠŸ" -ForegroundColor Green
        Write-Host "   æ‚£è€…: $($report.data.patientName)" -ForegroundColor Cyan
        Write-Host "   æ€»åˆ†: $($report.data.scoreResult.totalScore)" -ForegroundColor Cyan
        Write-Host "   ç­‰çº§: $($report.data.scoreResult.level)" -ForegroundColor Cyan
    }
} catch {
    Write-Host "âŒ è¯„åˆ†æŠ¥å‘Šè·å–å¤±è´¥: $($_.Exception.Message)" -ForegroundColor Red
}

# 4. æ·»åŠ ä¸“å®¶ç‚¹è¯„
Write-Host "4. æ·»åŠ ä¸“å®¶ç‚¹è¯„..." -ForegroundColor Yellow
$commentBody = @{ 
    patientId = 3835
    expertComment = "ç—…å†è®°å½•è§„èŒƒï¼Œè¯Šæ–­å‡†ç¡®ï¼Œå»ºè®®åŠ å¼ºæ²»ç–—æ–¹æ¡ˆçš„ä¸ªæ€§åŒ–æè¿°ã€‚"
} | ConvertTo-Json
try {
    $comment = Invoke-RestMethod -Uri "http://localhost:8080/admin-api/business/ai-score/expert-comment" -Method POST -ContentType "application/json" -Body $commentBody
    if ($comment.code -eq 0) {
        Write-Host "âœ… ä¸“å®¶ç‚¹è¯„ä¿å­˜æˆåŠŸ" -ForegroundColor Green
    }
} catch {
    Write-Host "âŒ ä¸“å®¶ç‚¹è¯„ä¿å­˜å¤±è´¥: $($_.Exception.Message)" -ForegroundColor Red
}

Write-Host "=== æµ‹è¯•å®Œæˆ ===" -ForegroundColor Green
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£å¸¸** - MySQLæœåŠ¡å™¨éœ€è¦è¿è¡Œ
2. **APIå¯†é’¥æœ‰æ•ˆ** - DeepSeek APIå¯†é’¥éœ€è¦æœ‰è¶³å¤Ÿä½™é¢
3. **ç½‘ç»œè¿æ¥** - éœ€è¦è®¿é—®å¤–éƒ¨APIæœåŠ¡
4. **å†…å­˜è¦æ±‚** - å»ºè®®è‡³å°‘2GBå¯ç”¨å†…å­˜
5. **JDKç‰ˆæœ¬** - éœ€è¦JDK 17æˆ–æ›´é«˜ç‰ˆæœ¬
6. **æ­£ç¡®çš„APIè·¯å¾„** - æ‰€æœ‰ä¸šåŠ¡APIéƒ½ä½¿ç”¨ `/admin-api/business/ai-score/` å‰ç¼€

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åº”ç”¨æ—¥å¿—æ–‡ä»¶
2. æ•°æ®åº“è¿æ¥çŠ¶æ€
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
5. ä½¿ç”¨æ­£ç¡®çš„API URLè·¯å¾„

## ğŸ“‹ APIæ¥å£æ±‡æ€»

| åŠŸèƒ½ | æ–¹æ³• | URL | è¯´æ˜ |
|------|------|-----|------|
| ç”ŸæˆAIè¯„åˆ† | POST | `/admin-api/business/ai-score/generate` | ä¼ å…¥patientIdç”Ÿæˆè¯„åˆ† |
| æŸ¥çœ‹è¯„åˆ†æŠ¥å‘Š | GET | `/admin-api/business/ai-score/report/{patientId}` | è·å–è¯¦ç»†è¯„åˆ†æŠ¥å‘Š |
| ä¿å­˜ä¸“å®¶ç‚¹è¯„ | POST | `/admin-api/business/ai-score/expert-comment` | æ·»åŠ ä¸“å®¶ç‚¹è¯„ |
| å¥åº·æ£€æŸ¥ | GET | `/actuator/health` | æ£€æŸ¥åº”ç”¨çŠ¶æ€ |

---

ç°åœ¨æ‚¨å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ›´æ–°åçš„æŒ‡å—æ­£ç¡®ä½¿ç”¨AIç—…å†è´¨æ§ç³»ç»Ÿäº†ï¼ğŸ‰ 