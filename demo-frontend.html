<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÂåªÁñóË¥®ÊéßÁ≥ªÁªü - ÊºîÁ§∫È°µÈù¢</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .patient-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .score-number {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .detail-item:last-child {
            border-bottom: none;
        }
        .comment-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .json-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .json-key {
            color: #569cd6;
        }
        .json-string {
            color: #ce9178;
        }
        .json-number {
            color: #b5cea8;
        }
        .json-boolean {
            color: #569cd6;
        }
        .json-null {
            color: #569cd6;
        }
        .json-punctuation {
            color: #d4d4d4;
        }
        .json-expandable {
            cursor: pointer;
            user-select: none;
        }
        .json-expanded::before {
            content: '‚ñº ';
            color: #808080;
        }
        .json-collapsed::before {
            content: '‚ñ∂ ';
            color: #808080;
        }
        .json-hidden {
            display: none;
        }
        .json-copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 11px;
        }
        .json-copy-btn:hover {
            background: #005a9e;
        }
        .json-container {
            position: relative;
        }
        .json-tree {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        .json-tree-item {
            margin-left: 15px;
        }
        .json-tree-toggle {
            cursor: pointer;
            user-select: none;
            color: #808080;
            margin-right: 5px;
        }
        .json-tree-key {
            color: #569cd6;
            font-weight: bold;
        }
        .json-tree-value {
            margin-left: 5px;
        }
        .json-tree-string {
            color: #ce9178;
        }
        .json-tree-number {
            color: #b5cea8;
        }
        .json-tree-boolean {
            color: #569cd6;
        }
        .json-tree-null {
            color: #569cd6;
        }
        .json-search-box {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 11px;
            width: 150px;
        }
        .json-highlight {
            background-color: #ffff00 !important;
            color: #000 !important;
        }
        .json-viewer pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .json-container .json-search-box:focus {
            outline: none;
            border-color: #007acc;
            box-shadow: 0 0 5px rgba(0, 122, 204, 0.3);
        }
        .json-stats {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- È°µÈù¢Ê†áÈ¢ò -->
            <div class="header">
                <h1>üè• AIÂåªÁñóË¥®ÊéßÁ≥ªÁªüÊºîÁ§∫</h1>
                <p>Êô∫ËÉΩÁóÖÂéÜËØÑÂàÜ‰∏é‰∏ìÂÆ∂ÁÇπËØÑÁ≥ªÁªü</p>
            </div>

            <!-- ÊÇ£ËÄÖ‰ø°ÊÅØÂç°Áâá -->
            <div class="patient-card">
                <h2>üë§ ÊÇ£ËÄÖ‰ø°ÊÅØ</h2>
                <el-row :gutter="20">
                    <el-col :span="6">
                        <div class="detail-item">
                            <strong>ÊÇ£ËÄÖID:</strong>
                            <el-input-number v-model="patientId" :min="1" size="small"></el-input-number>
                        </div>
                    </el-col>
                    <el-col :span="6">
                        <div class="detail-item">
                            <strong>ÊÇ£ËÄÖÂßìÂêç:</strong>
                            <span>{{ reportData.patientName || 'Êú™Ëé∑Âèñ' }}</span>
                        </div>
                    </el-col>
                    <el-col :span="12">
                        <div class="detail-item">
                            <el-button type="primary" @click="generateScore" :loading="generating">
                                <i class="el-icon-cpu"></i> ÁîüÊàêAIËØÑÂàÜ
                            </el-button>
                            <el-button type="success" @click="viewReport" :loading="loading">
                                <i class="el-icon-view"></i> Êü•ÁúãÊä•Âëä
                            </el-button>
                        </div>
                    </el-col>
                </el-row>
            </div>

            <!-- ËØÑÂàÜÁªìÊûúÂç°Áâá -->
            <div v-if="reportData.scoreResult" class="score-card">
                <h2>üìä AIËØÑÂàÜÁªìÊûú</h2>
                <div class="score-number">{{ reportData.scoreResult.totalScore }}</div>
                <el-tag :type="getScoreTagType(reportData.scoreResult.totalScore)" size="large">
                    {{ reportData.scoreResult.level }}
                </el-tag>
                <p style="margin-top: 10px; opacity: 0.9;">
                    ÁîüÊàêÊó∂Èó¥: {{ formatTime(reportData.createdTime) }}
                </p>
            </div>

            <!-- ËØ¶ÁªÜËØÑÂàÜ -->
            <div v-if="reportData.scoreResult" class="patient-card">
                <h3>üìã ËØ¶ÁªÜËØÑÂàÜ</h3>
                <div v-for="detail in reportData.scoreResult.details" :key="detail.item" class="detail-item">
                    <div style="flex: 1;">
                        <strong>{{ detail.item }}</strong>
                        <p style="margin: 5px 0; color: #666; font-size: 14px;">{{ detail.deduction }}</p>
                    </div>
                    <div style="text-align: right;">
                        <el-progress 
                            :percentage="(detail.score / detail.fullScore * 100)" 
                            :color="getProgressColor(detail.score / detail.fullScore * 100)"
                            :stroke-width="8"
                            style="width: 150px;">
                        </el-progress>
                        <div style="margin-top: 5px;">{{ detail.score }}/{{ detail.fullScore }}ÂàÜ</div>
                    </div>
                </div>
            </div>

            <!-- AIÊèêÁ§∫ËØçË∞ÉËØï‰ø°ÊÅØ -->
            <div v-if="reportData.aiPrompt" class="patient-card">
                <h3>ü§ñ AIÊèêÁ§∫ËØç (Ë∞ÉËØï‰ø°ÊÅØ)</h3>
                <el-collapse>
                    <el-collapse-item title="Êü•ÁúãÂÆåÊï¥ÊèêÁ§∫ËØç" name="prompt">
                        <div class="json-container">
                            <button class="json-copy-btn" @click="copyToClipboard(reportData.aiPrompt)">Â§çÂà∂</button>
                            <div class="json-viewer">
                                <pre style="white-space: pre-wrap; margin: 0;">{{ reportData.aiPrompt }}</pre>
                            </div>
                        </div>
                    </el-collapse-item>
                </el-collapse>
            </div>

            <!-- ÊÇ£ËÄÖÊï∞ÊçÆË∞ÉËØï‰ø°ÊÅØ -->
            <div v-if="reportData.patientBasicInfo || reportData.treatmentInfo" class="patient-card">
                <h3>üë§ ÊÇ£ËÄÖÊï∞ÊçÆË∞ÉËØï‰ø°ÊÅØ</h3>
                <el-collapse>
                    <el-collapse-item v-if="reportData.patientBasicInfo" title="ÊÇ£ËÄÖÂü∫Êú¨‰ø°ÊÅØ (Êé•Âè£1)" name="patient-basic">
                        <div class="json-container">
                            <input type="text" class="json-search-box" placeholder="ÊêúÁ¥¢..." v-model="searchTerm" @input="highlightSearch">
                            <button class="json-copy-btn" @click="copyToClipboard(reportData.patientBasicInfo)">Â§çÂà∂</button>
                            <div class="json-stats">{{ getJsonStats(reportData.patientBasicInfo) }}</div>
                            <div class="json-viewer">
                                <pre v-html="renderPrettyJson(reportData.patientBasicInfo)" style="margin: 0;"></pre>
                            </div>
                        </div>
                    </el-collapse-item>
                    <el-collapse-item v-if="reportData.treatmentInfo" title="ÂàùÂßãËØäÁñó‰ø°ÊÅØ (Êé•Âè£2)" name="treatment-info">
                        <div class="json-container">
                            <input type="text" class="json-search-box" placeholder="ÊêúÁ¥¢..." v-model="searchTerm" @input="highlightSearch">
                            <button class="json-copy-btn" @click="copyToClipboard(reportData.treatmentInfo)">Â§çÂà∂</button>
                            <div class="json-stats">{{ getJsonStats(reportData.treatmentInfo) }}</div>
                            <div class="json-viewer">
                                <pre v-html="renderPrettyJson(reportData.treatmentInfo)" style="margin: 0;"></pre>
                            </div>
                        </div>
                    </el-collapse-item>
                </el-collapse>
            </div>

            <!-- AIËØ∑Ê±Ç/ÂìçÂ∫îË∞ÉËØï‰ø°ÊÅØ -->
            <div v-if="reportData.aiRequestJson || reportData.aiResponseJson" class="patient-card">
                <h3>üîß AIË∞ÉËØï‰ø°ÊÅØ</h3>
                <el-collapse>
                    <el-collapse-item v-if="reportData.aiRequestJson" title="AIËØ∑Ê±ÇJSON" name="request">
                        <div class="json-container">
                            <input type="text" class="json-search-box" placeholder="ÊêúÁ¥¢..." v-model="searchTerm" @input="highlightSearch">
                            <button class="json-copy-btn" @click="copyToClipboard(reportData.aiRequestJson)">Â§çÂà∂</button>
                            <div class="json-stats">{{ getJsonStats(reportData.aiRequestJson) }}</div>
                            <div class="json-viewer">
                                <pre v-html="renderPrettyJson(reportData.aiRequestJson)" style="margin: 0;"></pre>
                            </div>
                        </div>
                    </el-collapse-item>
                    <el-collapse-item v-if="reportData.aiResponseJson" title="AIÂìçÂ∫îJSON" name="response">
                        <div class="json-container">
                            <input type="text" class="json-search-box" placeholder="ÊêúÁ¥¢..." v-model="searchTerm" @input="highlightSearch">
                            <button class="json-copy-btn" @click="copyToClipboard(reportData.aiResponseJson)">Â§çÂà∂</button>
                            <div class="json-stats">{{ getJsonStats(reportData.aiResponseJson) }}</div>
                            <div class="json-viewer">
                                <pre v-html="renderPrettyJson(reportData.aiResponseJson)" style="margin: 0;"></pre>
                            </div>
                        </div>
                    </el-collapse-item>
                </el-collapse>
            </div>

            <!-- ‰∏ìÂÆ∂ÁÇπËØÑ -->
            <div v-if="reportData.scoreResult" class="patient-card">
                <h3>üë®‚Äç‚öïÔ∏è ‰∏ìÂÆ∂ÁÇπËØÑ</h3>
                <div v-if="!editingComment" class="comment-section">
                    <p v-if="reportData.expertComment">{{ reportData.expertComment }}</p>
                    <p v-else style="color: #999; text-align: center;">ÊöÇÊó†‰∏ìÂÆ∂ÁÇπËØÑ</p>
                    <el-button type="text" @click="startEditComment">
                        {{ reportData.expertComment ? 'ÁºñËæëÁÇπËØÑ' : 'Ê∑ªÂä†ÁÇπËØÑ' }}
                    </el-button>
                </div>
                <div v-else class="comment-section">
                    <el-input
                        type="textarea"
                        v-model="newComment"
                        :rows="4"
                        placeholder="ËØ∑ËæìÂÖ•‰∏ìÂÆ∂ÁÇπËØÑ..."
                        maxlength="500"
                        show-word-limit>
                    </el-input>
                    <div style="margin-top: 10px; text-align: right;">
                        <el-button @click="cancelEditComment">ÂèñÊ∂à</el-button>
                        <el-button type="primary" @click="saveComment" :loading="savingComment">‰øùÂ≠ò</el-button>
                    </div>
                </div>
            </div>

            <!-- Êìç‰ΩúÊó•Âøó -->
            <div class="patient-card">
                <h3>üìù Êìç‰ΩúÊó•Âøó</h3>
                <div v-for="(log, index) in operationLogs" :key="index" style="padding: 10px 0; border-bottom: 1px solid #eee;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>{{ log.message }}</span>
                        <small style="color: #999;">{{ log.time }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                patientId: 225,
                reportData: {},
                generating: false,
                loading: false,
                savingComment: false,
                editingComment: false,
                newComment: '',
                operationLogs: [],
                searchTerm: ''
            },
            mounted() {
                this.addLog('È°µÈù¢Âä†ËΩΩÂÆåÊàê');
                this.viewReport();
            },
            methods: {
                async generateScore() {
                    this.generating = true;
                    this.addLog(`ÂºÄÂßã‰∏∫ÊÇ£ËÄÖ${this.patientId}ÁîüÊàêAIËØÑÂàÜ...`);
                    
                    try {
                        const response = await axios.post('http://localhost:8080/admin-api/business/ai-score/generate', {
                            patientId: this.patientId
                        });
                        
                        if (response.data.code === 0) {
                            this.$message.success('AIËØÑÂàÜÁîüÊàêÊàêÂäüÔºÅ');
                            this.addLog('AIËØÑÂàÜÁîüÊàêÊàêÂäü');
                            // ÁîüÊàêÊàêÂäüÂêéËá™Âä®Âä†ËΩΩÊä•Âëä
                            setTimeout(() => {
                                this.viewReport();
                            }, 1000);
                        } else {
                            this.$message.error(response.data.msg || 'AIËØÑÂàÜÁîüÊàêÂ§±Ë¥•');
                            this.addLog(`AIËØÑÂàÜÁîüÊàêÂ§±Ë¥•: ${response.data.msg}`);
                        }
                    } catch (error) {
                        console.error('ÁîüÊàêAIËØÑÂàÜÂ§±Ë¥•:', error);
                        this.$message.error('ÁΩëÁªúÂºÇÂ∏∏ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°ÊòØÂê¶Ê≠£Â∏∏ËøêË°å');
                        this.addLog(`ÁΩëÁªúÂºÇÂ∏∏: ${error.message}`);
                    } finally {
                        this.generating = false;
                    }
                },

                async viewReport() {
                    this.loading = true;
                    this.addLog(`Ê≠£Âú®Ëé∑ÂèñÊÇ£ËÄÖ${this.patientId}ÁöÑËØÑÂàÜÊä•Âëä...`);
                    
                    try {
                        const response = await axios.get(`http://localhost:8080/admin-api/business/ai-score/report/${this.patientId}`);
                        
                        if (response.data.code === 0) {
                            this.reportData = response.data.data;
                            this.$message.success('ËØÑÂàÜÊä•ÂëäÂä†ËΩΩÊàêÂäüÔºÅ');
                            this.addLog(`ËØÑÂàÜÊä•ÂëäÂä†ËΩΩÊàêÂäüÔºåÊÄªÂàÜ: ${this.reportData.scoreResult.totalScore}ÂàÜ`);
                        } else {
                            this.$message.warning(response.data.msg || 'Êú™ÊâæÂà∞ËØÑÂàÜÊä•Âëä');
                            this.addLog(`Êú™ÊâæÂà∞ËØÑÂàÜÊä•Âëä: ${response.data.msg}`);
                        }
                    } catch (error) {
                        console.error('Ëé∑ÂèñËØÑÂàÜÊä•ÂëäÂ§±Ë¥•:', error);
                        this.$message.error('ÁΩëÁªúÂºÇÂ∏∏ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°ÊòØÂê¶Ê≠£Â∏∏ËøêË°å');
                        this.addLog(`ÁΩëÁªúÂºÇÂ∏∏: ${error.message}`);
                    } finally {
                        this.loading = false;
                    }
                },

                startEditComment() {
                    this.editingComment = true;
                    this.newComment = this.reportData.expertComment || '';
                },

                cancelEditComment() {
                    this.editingComment = false;
                    this.newComment = '';
                },

                async saveComment() {
                    if (!this.newComment.trim()) {
                        this.$message.warning('ËØ∑ËæìÂÖ•ÁÇπËØÑÂÜÖÂÆπ');
                        return;
                    }

                    this.savingComment = true;
                    this.addLog('Ê≠£Âú®‰øùÂ≠ò‰∏ìÂÆ∂ÁÇπËØÑ...');
                    
                    try {
                        const response = await axios.post('http://localhost:8080/admin-api/business/ai-score/expert-comment', {
                            patientId: this.patientId,
                            expertComment: this.newComment.trim()
                        });
                        
                        if (response.data.code === 0) {
                            this.reportData.expertComment = this.newComment.trim();
                            this.editingComment = false;
                            this.$message.success('‰∏ìÂÆ∂ÁÇπËØÑ‰øùÂ≠òÊàêÂäüÔºÅ');
                            this.addLog('‰∏ìÂÆ∂ÁÇπËØÑ‰øùÂ≠òÊàêÂäü');
                        } else {
                            this.$message.error(response.data.msg || '‰∏ìÂÆ∂ÁÇπËØÑ‰øùÂ≠òÂ§±Ë¥•');
                            this.addLog(`‰∏ìÂÆ∂ÁÇπËØÑ‰øùÂ≠òÂ§±Ë¥•: ${response.data.msg}`);
                        }
                    } catch (error) {
                        console.error('‰øùÂ≠ò‰∏ìÂÆ∂ÁÇπËØÑÂ§±Ë¥•:', error);
                        this.$message.error('ÁΩëÁªúÂºÇÂ∏∏ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°ÊòØÂê¶Ê≠£Â∏∏ËøêË°å');
                        this.addLog(`ÁΩëÁªúÂºÇÂ∏∏: ${error.message}`);
                    } finally {
                        this.savingComment = false;
                    }
                },

                getScoreTagType(score) {
                    if (score >= 90) return 'success';
                    if (score >= 75) return 'primary';
                    if (score >= 60) return 'warning';
                    return 'danger';
                },

                getProgressColor(percentage) {
                    if (percentage >= 90) return '#67c23a';
                    if (percentage >= 75) return '#409eff';
                    if (percentage >= 60) return '#e6a23c';
                    return '#f56c6c';
                },

                formatTime(time) {
                    if (!time) return '';
                    return new Date(time).toLocaleString('zh-CN');
                },

                addLog(message) {
                    this.operationLogs.unshift({
                        message: message,
                        time: new Date().toLocaleTimeString()
                    });
                    // ‰øùÁïôÊúÄÊñ∞ÁöÑ10Êù°Êó•Âøó
                    if (this.operationLogs.length > 10) {
                        this.operationLogs = this.operationLogs.slice(0, 10);
                    }
                },

                formatJson(jsonString) {
                    try {
                        if (typeof jsonString === 'string') {
                            return JSON.stringify(JSON.parse(jsonString), null, 2);
                        }
                        return JSON.stringify(jsonString, null, 2);
                    } catch (e) {
                        return jsonString;
                    }
                },

                renderJsonWithHighlight(jsonString) {
                    try {
                        let jsonObj;
                        if (typeof jsonString === 'string') {
                            jsonObj = JSON.parse(jsonString);
                        } else {
                            jsonObj = jsonString;
                        }
                        return this.syntaxHighlight(JSON.stringify(jsonObj, null, 2));
                    } catch (e) {
                        return `<pre>${jsonString}</pre>`;
                    }
                },

                syntaxHighlight(json) {
                    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                        var cls = 'json-number';
                        if (/^"/.test(match)) {
                            if (/:$/.test(match)) {
                                cls = 'json-key';
                            } else {
                                cls = 'json-string';
                            }
                        } else if (/true|false/.test(match)) {
                            cls = 'json-boolean';
                        } else if (/null/.test(match)) {
                            cls = 'json-null';
                        }
                        return '<span class="' + cls + '">' + match + '</span>';
                    }).replace(/([{}[\],])/g, '<span class="json-punctuation">$1</span>');
                },

                copyToClipboard(text) {
                    try {
                        let textToCopy = text;
                        if (typeof text === 'object') {
                            textToCopy = JSON.stringify(text, null, 2);
                        }
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            this.$message.success('ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                        }).catch(() => {
                            // Fallback for older browsers
                            const textArea = document.createElement('textarea');
                            textArea.value = textToCopy;
                            document.body.appendChild(textArea);
                            textArea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textArea);
                            this.$message.success('ÂÜÖÂÆπÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                        });
                    } catch (e) {
                        this.$message.error('Â§çÂà∂Â§±Ë¥•Ôºö' + e.message);
                    }
                },

                renderPrettyJson(jsonString) {
                    try {
                        let jsonObj;
                        if (typeof jsonString === 'string') {
                            jsonObj = JSON.parse(jsonString);
                        } else {
                            jsonObj = jsonString;
                        }
                        
                        let prettyJson = JSON.stringify(jsonObj, null, 2);
                        
                        // ËØ≠Ê≥ïÈ´ò‰∫Æ
                        prettyJson = prettyJson
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                                let cls = 'json-number';
                                if (/^"/.test(match)) {
                                    if (/:$/.test(match)) {
                                        cls = 'json-key';
                                    } else {
                                        cls = 'json-string';
                                    }
                                } else if (/true|false/.test(match)) {
                                    cls = 'json-boolean';
                                } else if (/null/.test(match)) {
                                    cls = 'json-null';
                                }
                                return '<span class="' + cls + '">' + match + '</span>';
                            })
                            .replace(/([{}[\],])/g, '<span class="json-punctuation">$1</span>');
                        
                        // ÊêúÁ¥¢È´ò‰∫Æ
                        if (this.searchTerm && this.searchTerm.trim()) {
                            const regex = new RegExp(`(${this.escapeRegExp(this.searchTerm.trim())})`, 'gi');
                            prettyJson = prettyJson.replace(regex, '<mark class="json-highlight">$1</mark>');
                        }
                        
                        return prettyJson;
                    } catch (e) {
                        return `<span style="color: #ff6b6b;">JSON Ëß£ÊûêÈîôËØØ: ${e.message}</span><br/><br/>${jsonString}`;
                    }
                },

                escapeRegExp(string) {
                    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                },

                highlightSearch() {
                    // Ëß¶ÂèëÈáçÊñ∞Ê∏≤Êüì
                    this.$forceUpdate();
                },

                getJsonStats(jsonString) {
                    try {
                        let jsonObj;
                        if (typeof jsonString === 'string') {
                            jsonObj = JSON.parse(jsonString);
                        } else {
                            jsonObj = jsonString;
                        }
                        
                        const jsonStr = JSON.stringify(jsonObj);
                        const lines = JSON.stringify(jsonObj, null, 2).split('\n').length;
                        const size = new Blob([jsonStr]).size;
                        const keys = this.countKeys(jsonObj);
                        
                        let sizeStr = size < 1024 ? `${size}B` : 
                                     size < 1024 * 1024 ? `${(size/1024).toFixed(1)}KB` : 
                                     `${(size/(1024*1024)).toFixed(1)}MB`;
                        
                        return `${lines} Ë°å | ${keys} ÈîÆ | ${sizeStr}`;
                    } catch (e) {
                        return 'Êó†Êïà JSON';
                    }
                },

                countKeys(obj) {
                    let count = 0;
                    if (obj && typeof obj === 'object') {
                        if (Array.isArray(obj)) {
                            obj.forEach(item => count += this.countKeys(item));
                        } else {
                            count += Object.keys(obj).length;
                            Object.values(obj).forEach(value => count += this.countKeys(value));
                        }
                    }
                    return count;
                }
            }
        });
    </script>
</body>
</html> 